<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
    <script src="phonegap.js"></script>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
    <title>Page Title</title>
    <style type="text/css">
        p{
            text-align: center;
        }
        address{
            text-align: center;
        }
    </style>
    <script type="text/javascript">
    $(document).ready(function(){
        document.addEventListener("deviceready", function(){
            
            //boton para obtener la foto
            $('#foot').tap(function(){
                navigator.device.capture.captureImage(function(mediaFiles){
                    path = mediaFiles[0].fullPath;
                    $('#fot').append('<br><img id="imagen" src="'+path+'" width="100%" />').attr('rel',path);
                    },function(error){
                        navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                        },{limit:1});
                });
            
            //boton para obtener coordenadas
            var botoncoordenadas = $("#obtenercord");
               botoncoordenadas.tap(function(){
                obtenerCoordenadas();
               });
               
               //boton para guardar el regiistro
               var btnGuardar = $("#btnGuardar");
               btnGuardar.tap(function(){
                
                if($("#imagen").attr("src")==""){
                    alert("Tomar foto para registrar");
                    }else{
                        var nomNego = $("#nom").val();
                        var direcc = $("#direc").val();
                        var giiroo = $("#gir").val();
                        var tel = $("#tel").val();
                        //valor de la foto
                        var lati = $("#obtLatitud").val();
                        var long = $("#obtLongitud").val();
                        
                        
                        $.ajax({
                        type:"POST",
                        url:"http://vape2.260mb.net/registrar.php",
                        data:"Nombre="+nomNego+"&Direccion="+direcc+"&Giro="+giiroo+"&Telefono="+tel+"&Latitud="+lati+"&Longitud="+long,
                        success: guardarNegocio
                        });
                        
                        function guardarNegocio(datos) {
                            alert(datos)
                        }
                        uploadPhoto($("#imagen").attr("src"));
                    }
                });
               
               function uploadPhoto(foto) {
                var options = new FileUploadOptions();
                options.fileKey="file";
                options.fileName=$("#nom").val();
                options.mimeType="image/jpeg";
                //alert("si entro a upload: "+options.fileName);
                var params = {};
                params.value1 = "test";
                params.value2 = "param";
                options.params = params;
                
                var ft = new FileTransfer();
                ft.upload(foto,"http://itslmoviles.260mb.net/upload.php",function(r){
                    navigator.notification.confirm("El archivo: "+r.response,null, "Notificacion");
                    }, function(err){
                        navigator.notification.alert("Error: "+err.code+" detalle: "+err.response,null, "Error de Envío");
                        }, options);
               }
               
               function obtenerCoordenadas() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(obtenerCords, cordsError);
                    }else{
                        alert("Tu navegador no soporta o no tiene habilitado la 'Geolocalizacion'");
                        }
                }
                        
                function obtenerCords(position) {
                    $("#obtLatitud").val(position.coords.latitude);
                    $("#obtLongitud").val(position.coords.longitude);
                }
                
                function cordsError(error) {
                    alert('codigo:'+error.cade+' mensaje'+error.message);
                    }
               
            }, false);
        });
    </script>
</head>
<body>
    <div data-role="page" id="principal" data-theme="b">
        <div data-role="header">
            <p>RESTAURANTES DE LIBRES</p>
        </div>
        <div data-role="content">
            <ul>
                <li><a href="#registro">Registrar</a></li>
                <li><a href="#consultar">Consultar</a></li>
                <li><a href="#modificar">Modificar</a></li>
                <li><a href="#eliminar">Eliminar</a></li>
            </ul>
        </div>
        <div data-role="footer">
            <address>
                &#169; Desarrollado por Grupo YEMMDA<br>
                México, D. F. 55 40 13 24
            </address>
        </div>
    </div>
    
    <div data-role="page" id="registro">
        <div data-role="header" data-theme="b">
            <p>REGISTRO DE NEGOCIO</p>
        </div>
        <div data-role="content">
            <input type="text" id="nom" placeholder="Inserte el nombre de negocio">
            <input type="text" id="direc" placeholder="Direccion">
            <input type="text" id="gir" placeholder="Giro">
            <input type="text" id="tel" placeholder="Telefono">
            <div id="fot"></div>
            <input type="button" id="foot" value="TOMAR FOTO">
            <div id="acce"> </div>
            <input type="button" id="obtenercord" value="OBTENER COORDENADAS"/>
            <input type="text" id="obtLatitud" placeholder="LATITUD"/>
            <input type="text" id="obtLongitud" placeholder="LONGITUD"/>
            <input type="button" id="btnGuardar" value="GUARDAR REGISTRO">
        </div>
        <div data-role="footer" data-theme="b">
            <address>
                &#169; Desarrollado por Grupo YEMMDA<br>
                México, D. F. 55 40 13 24
            </address>
        </div>
    </div>
    
    <div data-role="page" id="consultar">
        <div data-role="header" data-theme="b">
            <p>CONSULTAR RESTAURANT</p>
        </div>
        <div data-role="content">
            
        </div>
        <div data-role="footer" data-theme="b">
            <address>
                &#169; Desarrollado por Grupo YEMMDA<br>
                México, D. F. 55 40 13 24
            </address>
        </div>
    </div>
    
    <div data-role="page" id="modificar">
        <div data-role="header" data-theme="b">
            <p>MODIFICAR DATOS DE RESTAURANT</p>
        </div>
        <div data-role="content">
            
        </div>
        <div data-role="footer" data-theme="b">
            <address>
                &#169; Desarrollado por Grupo YEMMDA<br>
                México, D. F. 55 40 13 24
            </address>
        </div>
    </div>
    
    <div data-role="page" id="eliminar">
        <div data-role="header" data-theme="b">
            <p>ELIMINAR RESTAURANT</p>
        </div>
        <div data-role="content">
            <input type="text" id="Id_Elimi" placeholder="Ingrese el ID para eliminar el registro">
        </div>
        <div data-role="footer" data-theme="b">
            <address>
                &#169; Desarrollado por Grupo YEMMDA<br>
                México, D. F. 55 40 13 24
            </address>
        </div>
    </div>
    
</body>
</html>